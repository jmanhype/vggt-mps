name: Claude Code Self-Improve

on:
  schedule:
    # Mondays at 06:00 America/Chicago (11:00 UTC)
    - cron: "0 11 * * 1"
  workflow_dispatch:

permissions:
  contents: write
  issues: write
  pull-requests: write
  id-token: write

jobs:
  self-improve:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Claude Code Self-Improvement
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            You are analyzing this repository for self-improvement opportunities. Follow these steps:

            1. **Project Summary**: Read the README and provide a one-paragraph summary of what this project does.

            2. **Missing Baseline Files**: Check for and identify any missing:
               - README quickstart section
               - LICENSE file
               - SECURITY.md
               - CODEOWNERS file
               - Basic CI workflow (if appropriate)

            3. **Dependency & Build Issues**:
               - Review dependency files (requirements.txt, package.json, etc.)
               - Check for outdated or vulnerable dependencies
               - Look for build or configuration issues
               - Propose the smallest safe improvements without changing public APIs

            4. **Implementation**:
               - Implement ONLY documentation, CI, or metadata fixes
               - DO NOT modify core functionality or public APIs
               - Follow the guardrails in CLAUDE.md

            5. **Create Pull Request**:
               - Open a PR with your changes
               - Include a receipt line in the format: `Receipt: <hash of changes>`
               - Summarize what was fixed and why

            Remember to check CLAUDE.md for additional constraints.
          claude_args: "--max-turns 8"
